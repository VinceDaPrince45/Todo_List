import { projectObject, taskObject } from './project.js';
import { createProjectForm, createTaskForm } from './forms.js';

const projects = document.querySelector('.projects');
const referenceProject = document.querySelector('.buttonProject')
const content = document.querySelector('.content');
const cards = document.querySelector('.cards');
const referenceTask = document.querySelector('.buttonTasks');

// PROJECTS

export function evaluateProject(mainlist) {
    if (!projects.contains(document.querySelector('#form'))) {
        // add form before the button
        addForm(referenceProject,createProjectForm());
        // access the button inside form and add event listener to submit
        let addProject = document.querySelector('.addProject');
        addProject.addEventListener('click', () => {
            // add input to database
            addToProjects(mainlist);
            // remove form
            removeForm(projects);
            // update list
            let projectItems = document.querySelectorAll('.projectItem');
            updateSidebar(referenceProject,projectItems,mainlist);
            projectItems = document.querySelectorAll('.projectItem');
            addProjectListener(projectItems,mainlist);
        })
        // access the cancel button inside form and delete form when pressed
        let cancelProject = document.querySelector('.cancelProject');
        cancelProject.addEventListener('click', () => {
            removeForm(projects);
        })
    }
}

// add new form before button
function addForm(referencePoint,form) {
    referencePoint.before(form)
}

// remove form
function removeForm(parent) {
    parent.removeChild(document.querySelector('#form'));
}

// function to add inputs to data array

function addToProjects(mainlist) {
    let projectName = document.querySelector('.projectName');
    let newProject = new projectObject(projectName.value);
    mainlist.push(newProject);
}

// function to update names on sidebar

function updateSidebar(referencepoint,mainitems,mainlist) {
    // delete all alements and readd name of projects from array to sidebar
    for (const item of mainitems) {
        projects.removeChild(item);
    }
    for (const item of mainlist) {
        let div = document.createElement('div');
        div.classList.add('projectItem');
        div.textContent = item.name;
        referencepoint.before(div);
    }
}

// need to add event listener to each project

function addProjectListener(domArray,mainlist) {
    let arr = Array.from(domArray);
    for (const item of arr) {
        item.addEventListener('click', (event) => {
            changeHeader(item.textContent);
            refreshActive(event)
            activeProject = mainlist[arr.indexOf(item)].tasks;
            console.log(activeProject);
            clearDisplay();
            displayActive(activeProject);
        })
    }
}


// TASKS

// function to add task input values to allTask array

function addToArray(list) {
    let taskName = document.querySelector('.taskName');
    let taskDescription = document.querySelector('.taskDescription');
    let taskDate = document.querySelector('.taskDate');
    let newTask = new taskObject(taskName.value,taskDescription.value,taskDate.value);
    list.push(newTask);
}

export function evaluateTask(mainlist,specificlist) {
    if (!content.contains(document.querySelector('#form'))) {
        // add form before button
        addForm(referenceTask,createTaskForm());
        // access button inside form and add event listener to submit
        let addTask = document.querySelector('.addTask');
        addTask.addEventListener('click', () => {
            // add input to database
            if (mainlist == specificlist) {
                addToArray(mainlist);
            } else {
                addToArray(mainlist);
                addToArray(specificlist);
            }
            // remove form
            removeForm(content);
            // update display
            clearDisplay();
            displayActive(specificlist);

        })
        // access cancel button inside form and delete when pressed
        let cancelTask = document.querySelector('.cancelTask');
        cancelTask.addEventListener('click', () => {
            removeForm(content);
        })
    }
}

export function changeHeader(phrase) {
    let header = document.querySelector('.content > .header');
    header.textContent = phrase;
}

export function changeTabs(event,mainlist) {
    if (event.target && (event.target.classList.contains('hometab') || event.target.classList.contains('projectItem')) && event.target.classList.contains('active')) {
        // need to delete all previous content
        clearDisplay();
        // if event.target id is all tasks,iterate through mainlist and display each property of task
        displayActive(mainlist);
    }
}

// when clicking addTask, look for whats active then assign a variable the array that will be accessed

export function refreshActive(event) {
    let tabs = document.querySelectorAll('.hometab');
    let projectItems = document.querySelectorAll('.projectItem');
    for (const tab of tabs) {
        tab.classList.remove('active');
    }
    for (const item of projectItems) {
        item.classList.remove('active');
    }
    if (event.target && (event.target.classList.contains('hometab') || event.target.classList.contains('projectItem'))) {
        event.target.classList.add('active');
    }
}

// function takes in arrays from main js file and returns the one thats needed after checking active tab

export function checkActive(arrayOne,arrayTwo,arrayThree,arrayFour) {
    let tabs = document.querySelectorAll('.hometab');
    let projectItems = document.querySelectorAll('.projectItem');
    for (const tab of tabs) {
        if (tab.classList.contains('active')) {
            switch (tab.getAttribute('id')) {
                case 'allTasks':
                    return arrayOne;
                case 'today' :
                    return arrayTwo;
                case 'nextWeek':
                    return arrayThree;
                case 'important':
                    return arrayFour;
            }
        }
    }
    for (const item of projectItems) {
        if (item.classList.contains('active')) {
            console.log(activeProject);
            return activeProject;
        }
    }
}

function displayActive(array) {
    //  remove previous content
    // iterate through array and add as cards
    for (const item of array) {
            let div = document.createElement('div');
            div.classList.add('card');
            let name = document.createElement('div');
            name.textContent = item.name;
            let description = document.createElement('div');
            description.textContent = item.description;
            let date = document.createElement('div');
            date.textContent = item.date;
            let priority = document.createElement('div');
            priority.textContent = item.priority;
            div.append(name,description,date,priority);
            cards.appendChild(div);
    }
}

// remove previous content

function clearDisplay() {
    let singleCards = document.querySelectorAll('.card');
    for (const card of singleCards) {
        cards.removeChild(card);
    }
}